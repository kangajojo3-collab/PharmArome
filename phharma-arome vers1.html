<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmArome - Huiles Essentielles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4; /* Light green for a fresh, natural feel */
        
        }
        .product-card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            cursor: pointer;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .add-to-cart-btn {
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .add-to-cart-btn:hover {
            transform: scale(1.05);
        }
        /* Styles pour les modaux */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
        /* Style pour le conteneur du message de chargement */
        #loading-message {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px 40px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            text-align: center;
        }
        #loading-message .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header (Sticky) -->
    <header class="bg-emerald-600 shadow-md p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" class="text-white text-3xl font-bold">
                PharmArome
            </a>
            <nav class="flex items-center space-x-4">
                <ul class="flex space-x-4">
                    <li><a href="#" class="text-white hover:text-gray-200 transition-colors hidden md:inline">Accueil</a></li>
                    <li><a href="#collection" class="text-white font-semibold hidden md:inline">Huiles</a></li>
                    <li><a href="#accessoires" class="text-white hover:text-gray-200 transition-colors hidden md:inline">Accessoires</a></li>
                    <li><a href="#about" class="text-white hover:text-gray-200 transition-colors hidden md:inline">À propos</a></li>
                    <li><a href="#contact" class="text-white hover:text-gray-200 transition-colors hidden md:inline">Contact</a></li>
                </ul>
                <div class="relative cursor-pointer text-white" onclick="openCartModal()">
                    <i class="fas fa-shopping-cart text-2xl"></i>
                    <span id="cart-count" class="absolute -top-1 -right-2 bg-amber-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Carousel Section -->
    <div id="hero-carousel" class="relative w-full overflow-hidden h-96">
        <div id="carousel-track" class="h-full flex transition-transform duration-700 ease-in-out">
            <!-- Slides will be generated by JavaScript -->
        </div>

        <!-- Previous Button -->
        <button id="prev-btn" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white bg-opacity-30 p-2 rounded-full text-white text-2xl hover:bg-opacity-50 transition-colors z-20">
            <i class="fas fa-chevron-left"></i>
        </button>
        <!-- Next Button -->
        <button id="next-btn" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white bg-opacity-30 p-2 rounded-full text-white text-2xl hover:bg-opacity-50 transition-colors z-20">
            <i class="fas fa-chevron-right"></i>
        </button>

        <!-- Carousel Dots -->
        <div id="carousel-dots" class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2 z-20">
            <!-- Dots will be generated by JavaScript -->
        </div>
    </div>

    <!-- Main Content - Search and Product Grid -->
    <main id="main-content" class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- Search and Filter Section -->
        <div class="flex flex-col sm:flex-row justify-center items-center mb-8 space-y-4 sm:space-y-0 sm:space-x-4">
            <input id="search-input" type="text" placeholder="Rechercher une huile ou un accessoire..." class="w-full sm:w-80 p-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-emerald-500">
            <div class="flex space-x-2">
                <button id="filter-all" onclick="filterItems('all')" class="filter-btn bg-emerald-600 text-white font-semibold py-3 px-6 rounded-full hover:bg-emerald-700 transition-colors">
                    Tout
                </button>
                <button id="filter-oils" onclick="filterItems('oils')" class="filter-btn bg-gray-200 text-gray-800 font-semibold py-3 px-6 rounded-full hover:bg-gray-300 transition-colors">
                    Huiles
                </button>
                <button id="filter-accessories" onclick="filterItems('accessories')" class="filter-btn bg-gray-200 text-gray-800 font-semibold py-3 px-6 rounded-full hover:bg-gray-300 transition-colors">
                    Accessoires
                </button>
            </div>
        </div>
        
        <!-- Section Conseillers Aromathérapie -->
        <div class="mt-16 bg-white rounded-2xl p-8 shadow-lg">
            <h2 class="text-4xl font-bold text-center mb-8 text-emerald-600">
                Conseils Aromathérapie ✨
            </h2>
            <p class="text-center text-lg text-gray-700 mb-8 max-w-2xl mx-auto">
                Ajoutez des huiles à votre liste pour obtenir des conseils personnalisés et des recettes de mélanges.
            </p>
            <div class="flex flex-col sm:flex-row items-center mb-4 space-y-4 sm:space-y-0 sm:space-x-4">
                <input id="aromatherapy-need" type="text" placeholder="Votre besoin (ex: relaxation, énergie, sommeil)..." class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                <button onclick="getAromatherapyAdvice()" class="bg-emerald-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-emerald-700 transition duration-300 whitespace-nowrap">
                    Créer une recette ✨
                </button>
            </div>
            <div id="selected-oils-list" class="flex flex-wrap gap-2 mb-6 min-h-[40px] border border-gray-300 p-2 rounded-xl">
                <p id="selected-oils-placeholder" class="text-gray-500">Aucune huile sélectionnée</p>
            </div>
            <div id="aromatherapy-result" class="bg-gray-50 p-6 rounded-xl hidden">
                <!-- LLM response will be rendered here -->
            </div>
        </div>

        <!-- Dynamic Product Grid -->
        <div id="products-section">
            <h2 id="collection" class="text-4xl font-bold text-center my-8 text-emerald-600">
                Nos Huiles Essentielles
            </h2>
            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Product cards will be generated here by JavaScript -->
            </div>
        </div>


        <!-- Accessoires en Gros Section -->
        <div id="accessories-section" class="mt-16">
            <h2 id="accessoires" class="text-4xl font-bold text-center my-8 text-emerald-600">
                Accessoires en Gros
            </h2>
            <p class="text-center text-lg text-gray-700 mb-8 max-w-2xl mx-auto">
                Nous proposons une gamme de contenants, vaporisateurs et accessoires pour les détaillants et les fabricants de produits à base d'huiles essentielles.
            </p>

            <!-- Dynamic Accessory Grid -->
            <div id="accessory-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Accessory cards will be generated here by JavaScript -->
            </div>
        </div>

        <!-- À Propos Section -->
        <div id="about" class="mt-16 bg-white rounded-2xl p-8 shadow-lg">
            <h2 class="text-4xl font-bold text-center mb-8 text-emerald-600">
                À propos de PharmArome
            </h2>
            <p class="text-lg text-gray-700 text-center max-w-2xl mx-auto">
                Depuis notre fondation, nous nous engageons à offrir des huiles essentielles de la plus haute qualité. Notre mission est de vous fournir des produits purs, éthiques et efficaces pour votre bien-être. Nous travaillons en étroite collaboration avec des producteurs qui respectent les normes d'agriculture biologique et durable.
            </p>
        </div>
        
        <!-- Contact Section -->
        <div id="contact" class="mt-16 bg-white rounded-2xl p-8 shadow-lg">
            <h2 class="text-4xl font-bold text-center mb-8 text-emerald-600">
                Contactez-nous
            </h2>
            <form class="max-w-xl mx-auto space-y-4">
                <div>
                    <label for="name" class="block text-gray-700 font-semibold mb-2">Nom</label>
                    <input type="text" id="name" class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label for="email" class="block text-gray-700 font-semibold mb-2">Email</label>
                    <input type="email" id="email" class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label for="message" class="block text-gray-700 font-semibold mb-2">Message</label>
                    <textarea id="message" rows="4" class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-emerald-500"></textarea>
                </div>
                <button type="submit" class="w-full bg-emerald-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-emerald-700 transition duration-300">
                    Envoyer
                </button>
            </form>
        </div>
    </main>

    <!-- Product Detail Section (Initially hidden) -->
    <section id="product-detail-page" class="hidden container mx-auto p-4 sm:p-6 lg:p-8">
        <button onclick="showMainPage()" class="mb-6 text-emerald-600 font-semibold hover:underline">
            <i class="fas fa-arrow-left mr-2"></i> Retour
        </button>
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden md:flex">
            <img id="product-detail-image" src="" alt="Détails du produit" class="md:w-1/2 w-full h-64 md:h-auto object-cover">
            <div class="p-6 md:p-8 flex flex-col justify-center">
                <h1 id="product-detail-title" class="text-3xl md:text-4xl font-bold mb-2 text-emerald-600"></h1>
                <p id="product-detail-subtitle" class="text-lg text-gray-600 mb-4"></p>
                <p id="product-detail-description" class="text-gray-700 mb-6 text-base"></p>
                
                <div class="flex flex-col space-y-4 mb-6">
                    <button onclick="getOilGuide()" class="bg-emerald-600 text-white font-semibold py-3 px-8 rounded-xl hover:bg-emerald-700 transition duration-300">
                        Obtenir un guide ✨
                    </button>
                    <div id="guide-result" class="bg-gray-50 p-4 rounded-xl hidden">
                        <!-- LLM response for guide will be rendered here -->
                    </div>
                </div>

                <div class="flex items-center justify-between mb-6">
                    <span id="product-detail-price" class="text-3xl font-bold text-emerald-600"></span>
                    <button id="add-to-cart-detail-btn" class="bg-amber-600 text-white font-semibold py-3 px-8 rounded-xl add-to-cart-btn shadow-md">
                        Ajouter au Panier
                    </button>
                </div>
                <div id="product-detail-disclaimer" class="text-sm text-gray-500 italic">
                    <p>*Les propriétés et usages de ce produit sont à titre indicatif et ne remplacent pas l'avis d'un professionnel de la santé.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal for Quick View -->
    <div id="product-modal" class="modal">
        <div class="modal-content text-center">
            <span class="close-btn" onclick="closeModal('product-modal')">&times;</span>
            <h3 id="modal-title" class="text-2xl font-bold mb-2"></h3>
            <p id="modal-description" class="text-gray-600 mb-4"></p>
            <span id="modal-price" class="text-2xl font-bold text-emerald-600 mb-4 block"></span>
            <button id="modal-add-to-cart-btn" class="bg-amber-600 text-white font-semibold py-3 px-8 rounded-xl add-to-cart-btn shadow-md">
                Ajouter au Panier
            </button>
        </div>
    </div>

    <!-- Modal for Shopping Cart -->
    <div id="cart-modal" class="modal">
        <div class="modal-content text-left">
            <span class="close-btn" onclick="closeModal('cart-modal')">&times;</span>
            <h3 class="text-2xl font-bold mb-4 text-center">Votre Panier</h3>
            <div id="cart-items" class="space-y-4 max-h-80 overflow-y-auto pr-2">
                <!-- Les articles du panier seront générés ici par JavaScript -->
            </div>
            <div class="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center">
                <span class="text-xl font-bold">Total:</span>
                <span id="cart-total" class="text-2xl font-bold text-emerald-600">0,00 €</span>
            </div>
            <div class="flex justify-between mt-6 space-x-4">
                <button onclick="emptyCart()" class="bg-red-500 text-white font-semibold py-3 px-6 rounded-full hover:bg-red-600 transition duration-300 w-1/2">
                    Vider le Panier
                </button>
                <button class="bg-emerald-600 text-white font-semibold py-3 px-6 rounded-full hover:bg-emerald-700 transition duration-300 w-1/2">
                    Procéder au Paiement
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Message -->
    <div id="loading-message">
        <div class="spinner"></div>
        <p>Génération en cours...</p>
    </div>
    
    <script>
        const products = [
            { id: 1, title: 'Huile de Lavande Fine', subtitle: 'Apaisante et calmante', price: 12, description: 'Connue pour ses propriétés apaisantes, elle favorise la détente et un sommeil réparateur. Incontournable en aromathérapie.', image: 'https://i.pinimg.com/originals/db/2e/e4/db2ee454aa820346b3e0676a85c499bd.jpg', type: 'oil' },
            { id: 2, title: 'Huile d\'Eucalyptus Globulus', subtitle: 'Dégage les voies respiratoires', price: 9, description: 'Idéale en diffusion pour dégager les voies respiratoires et purifier l\'atmosphère.', image: 'https://placehold.co/600x400/34d399/ffffff?text=Eucalyptus', type: 'oil' },
            { id: 3, title: 'Huile de Citron', subtitle: 'Énergisante et purifiante', price: 10, description: 'Stimulante et purifiante, elle aide à assainir l\'air et à dynamiser l\'esprit. Un must-have pour une maison saine.', image: 'https://placehold.co/600x400/fcd34d/ffffff?text=Citron', type: 'oil' },
            { id: 4, title: 'Huile de Menthe Poivrée', subtitle: 'Tonique et rafraîchissante', price: 14, description: 'Tonique et rafraîchissante, elle est parfaite pour soulager les maux de tête et améliorer la concentration. Un effet coup de fouet garanti.', image: 'https://placehold.co/600x400/6b7280/ffffff?text=Menthe+Poivree', type: 'oil' },
            { id: 5, title: 'Huile d\'Ylang-Ylang', subtitle: 'Relaxante et équilibrante', price: 18, description: 'Avec son parfum exotique, elle aide à apaiser les tensions et à équilibrer les émotions. Un allié pour la relaxation profonde.', image: 'https://placehold.co/600x400/d946ef/ffffff?text=Ylang-Ylang', type: 'oil' },
            { id: 6, title: 'Huile de Tea Tree', subtitle: 'Purifiante et assainissante', price: 11, description: 'Reconnue pour ses vertus purifiantes et assainissantes. Indispensable pour le soin des peaux à imperfections.', image: 'https://placehold.co/600x400/10b981/ffffff?text=Tea+Tree', type: 'oil' },
            { id: 7, title: 'Huile de Géranium Rosat', subtitle: 'Équilibrante et florale', price: 16, description: 'Équilibrante et harmonisante, elle offre un parfum floral doux qui régénère la peau et apaise l\'esprit.', image: 'https://placehold.co/600x400/ec4899/ffffff?text=Geranium', type: 'oil' },
            { id: 8, title: 'Mélange Agrumes Fraîcheur', subtitle: 'Énergisant et joyeux', price: 15, description: 'Un mélange d\'agrumes revitalisant pour une ambiance joyeuse et énergisante. Chasse la fatigue et la morosité.', image: 'https://placehold.co/600x400/fde047/ffffff?text=Agrumes', type: 'oil' },
            { id: 9, title: 'Huile de Gaulthérie Odorante', subtitle: 'Pour les douleurs musculaires', price: 17, description: 'Reconnue pour ses propriétés anti-inflammatoires, elle soulage les douleurs musculaires et articulaires. Un incontournable pour les sportifs.', image: 'https://placehold.co/600x400/9b59b6/ffffff?text=Gaultherie', type: 'oil' },
            { id: 10, title: 'Huile d\'Orange Douce', subtitle: 'Anti-stress et apaisante', price: 8, description: 'Un parfum joyeux qui combat le stress et l\'anxiété. Elle purifie l\'air et favorise la relaxation. Idéale pour les diffuseurs.', image: 'https://placehold.co/600x400/f39c12/ffffff?text=Orange+Douce', type: 'oil' },
            { id: 11, title: 'Huile de Bergamote', subtitle: 'Relaxante et tonifiante', price: 15, description: 'Apaise les tensions et les émotions, aide à la relaxation et à la bonne humeur. Son parfum frais est parfait pour les parfums d\'ambiance.', image: 'https://www.lesourceur.com/wp-content/uploads/2021/05/Bergamote-Matiere.png', type: 'oil' },
            { id: 12, title: 'Huile de Cèdre de l\'Atlas', subtitle: 'Assainissante et fortifiante', price: 13, description: 'Idéale en diffusion pour apaiser les voies respiratoires. Reconnue pour ses vertus assainissantes et ses bienfaits sur les cheveux.', image: 'https://placehold.co/600x400/795548/ffffff?text=Cedre', type: 'oil' }
        ];

        const accessories = [
            { id: 13, title: 'Flacons en verre ambré', subtitle: 'Qualité professionnelle', price: 2.50, description: 'Flacons en verre ambré de haute qualité pour préserver les huiles de la lumière. Idéal pour la revente de vos mélanges maison.', image: 'https://placehold.co/600x400/a3e635/ffffff?text=Flacons+en+verre+ambre', type: 'accessory' },
            { id: 14, title: 'Vaporisateur en aluminium', subtitle: 'Diffusion fine et homogène', price: 3.00, description: 'Conçu pour une diffusion fine et homogène, ce vaporisateur en aluminium est à la fois robuste et élégant. Idéal pour les sprays d\'ambiance et les lotions.', image: 'https://placehold.co/600x400/f87171/ffffff?text=Vaporisateur+en+aluminium', type: 'accessory' },
            { id: 15, title: 'Diffuseur ultrasonique', subtitle: 'Ambiance relaxante', price: 25.00, description: 'Crée une ambiance relaxante et diffuse les arômes subtilement. Ce modèle silencieux et élégant est un incontournable pour les espaces de bien-être.', image: 'https://placehold.co/600x400/94a3b8/ffffff?text=Diffuseur+ultrasonique', type: 'accessory' },
            { id: 16, title: 'Pipettes et compte-gouttes', subtitle: 'Dosage précis', price: 1.50, description: 'Indispensable pour un dosage précis et sans gâchis de vos huiles. En verre borosilicate pour une durabilité maximale.', image: 'https://placehold.co/600x400/a78bfa/ffffff?text=Pipettes', type: 'accessory' },
            { id: 17, title: 'Flacons Roll-on 10ml', subtitle: 'Application pratique', price: 1.80, description: 'Parfaits pour les mélanges personnalisés, ces flacons roll-on permettent une application directe et pratique sur la peau. Idéal pour la revente.', image: 'https://placehold.co/600x400/94a3b8/ffffff?text=Flacons+Roll-on', type: 'accessory' },
            { id: 18, title: 'Mini-Diffuseur pour Voiture', subtitle: 'Pour des trajets apaisants', price: 8.50, description: 'Branchez ce mini-diffuseur à un port USB de voiture pour diffuser vos huiles essentielles préférées sur la route. Un accessoire prisé par les conducteurs.', image: 'https://placehold.co/600x400/38bdf8/ffffff?text=Diffuseur+voiture', type: 'accessory' },
            { id: 19, title: 'Flacons Compte-gouttes en verre', subtitle: 'Dosage parfait', price: 2.00, description: 'Ces flacons en verre ambré sont munis d\'un compte-gouttes pour un dosage précis. Capacité de 30 ml, idéal pour les sérums et les huiles de massage.', image: 'https://placehold.co/600x400/a3e635/ffffff?text=Flacon+compte-gouttes', type: 'accessory' },
            { id: 20, title: 'Couvercles et Étiquettes', subtitle: 'Pour une présentation soignée', price: 0.50, description: 'Lot de couvercles et d\'étiquettes pré-imprimées pour une organisation professionnelle et élégante de vos produits. Vendu en packs de 50.', image: 'https://placehold.co/600x400/60a5fa/ffffff?text=Couvercles+et+etiquettes', type: 'accessory' }
        ];
        
        const carouselSlides = [
            {
                title: 'Respirez, Détendez-vous, Révélez',
                buttonText: 'Découvrir Nos Huiles',
                buttonHref: '#collection',
                image: 'https://placehold.co/1200x600/60c19a/ffffff?text=Respirez'
            },
            {
                title: 'Pureté et Qualité Supérieure',
                buttonText: 'En savoir plus',
                buttonHref: '#about',
                image: 'https://placehold.co/1200x600/34d399/ffffff?text=Purete'
            },
            {
                title: 'Transformez Votre Espace',
                subtitle: 'Diffuseurs et Accessoires',
                description: 'Découvrez nos diffuseurs et accessoires élégants.',
                buttonText: 'Voir les accessoires',
                buttonHref: '#accessoires',
                image: 'https://www.les-essentiels.co/wp-content/uploads/2019/04/diffuseurs-huiles-essentielles.jpg'
            },
            {
                title: 'Harmonie et Équilibre',
                subtitle: 'Trouvez votre sérénité intérieure.',
                buttonText: 'Nos Produits Bien-être',
                buttonHref: '#collection',
                image: 'https://placehold.co/1200x600/bbf7d0/ffffff?text=Equilibre'
            },
            {
                title: 'Directement de la Nature',
                subtitle: 'Des essences pures pour votre santé.',
                buttonText: 'Nos Sources Éthiques',
                buttonHref: '#about',
                image: 'https://placehold.co/1200x600/65a30d/ffffff?text=Nature'
            },
            {
                title: 'Le Secret de la Beauté',
                subtitle: 'Votre rituel de soin naturel.',
                buttonText: 'Découvrir la Gamme Beauté',
                buttonHref: '#collection',
                image: 'https://placehold.co/1200x600/fbcfe8/000000?text=Beaute'
            }
        ];

        let cart = [];
        let selectedOils = [];
        var slideInterval;
        let currentFilter = 'all'; // État initial du filtre
        const allItems = [...products, ...accessories];
        
        // Gère l'état de l'application (vue principale, vue détail)
        const appState = {
            view: 'main', // 'main' ou 'product-detail'
            selectedProduct: null,
        };

        // Fonction pour générer le code HTML des cartes
        function generateCards(data, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; // Nettoyer le conteneur avant de le remplir
            data.forEach(item => {
                const isOil = item.type === 'oil';
                const cardHtml = `
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden product-card flex flex-col" onclick="showProductPage(${item.id})">
                        <img src="${item.image}" alt="${item.title}" class="w-full h-48 object-cover">
                        <div class="p-4 text-center flex flex-col flex-grow justify-between">
                            <div>
                                <h3 class="text-lg font-semibold mb-1">${item.title}</h3>
                                <p class="text-gray-600 mb-2">${item.subtitle}</p>
                            </div>
                            <div>
                                <span class="text-xl font-bold text-emerald-600 block mb-4">${item.price.toFixed(2)} €</span>
                                <button onclick="addToCartAndClose(event, ${item.id})" class="bg-amber-600 text-white font-semibold py-2 px-6 rounded-xl w-full add-to-cart-btn shadow-md">
                                    Ajouter au Panier
                                </button>
                                ${isOil ? `
                                    <button onclick="addToSelectedOils(event, ${item.id})" class="mt-2 bg-emerald-100 text-emerald-800 font-semibold py-2 px-6 rounded-xl w-full hover:bg-emerald-200 transition-colors">
                                        Ajouter aux conseils ✨
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHtml;
            });
        }

        function addToCartAndClose(event, id) {
            event.stopPropagation();
            const item = allItems.find(p => p.id === id);
            if (item) {
                addToCart(item);
            }
        }
        
        function addToSelectedOils(event, id) {
            event.stopPropagation();
            const item = products.find(p => p.id === id);
            if (item && !selectedOils.find(oil => oil.id === id)) {
                selectedOils.push(item);
                renderSelectedOils();
            }
        }
        
        function removeFromSelectedOils(id) {
            selectedOils = selectedOils.filter(oil => oil.id !== id);
            renderSelectedOils();
        }
        
        function renderSelectedOils() {
            const container = document.getElementById('selected-oils-list');
            container.innerHTML = '';
            if (selectedOils.length === 0) {
                container.innerHTML = '<p id="selected-oils-placeholder" class="text-gray-500">Aucune huile sélectionnée</p>';
                return;
            }
            selectedOils.forEach(oil => {
                const pillHtml = `
                    <div class="bg-emerald-200 text-emerald-900 rounded-full px-4 py-1 flex items-center space-x-2">
                        <span>${oil.title}</span>
                        <button onclick="removeFromSelectedOils(${oil.id})" class="text-emerald-900 hover:text-red-600">
                            <i class="fas fa-times-circle"></i>
                        </button>
                    </div>
                `;
                container.innerHTML += pillHtml;
            });
        }

        // Gère l'application des filtres et de la recherche
        function applyFiltersAndSearch() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const productGrid = document.getElementById('product-grid');
            const accessoryGrid = document.getElementById('accessory-grid');
            const productsSection = document.getElementById('products-section');
            const accessoriesSection = document.getElementById('accessories-section');

            // Filtrer les données en fonction du terme de recherche
            const filteredProducts = products.filter(item => 
                item.title.toLowerCase().includes(searchTerm) ||
                item.subtitle.toLowerCase().includes(searchTerm) ||
                item.description.toLowerCase().includes(searchTerm)
            );
            const filteredAccessories = accessories.filter(item => 
                item.title.toLowerCase().includes(searchTerm) ||
                item.subtitle.toLowerCase().includes(searchTerm) ||
                item.description.toLowerCase().includes(searchTerm)
            );

            // Rendre les cartes en fonction du filtre sélectionné
            if (currentFilter === 'all') {
                productsSection.classList.remove('hidden');
                accessoriesSection.classList.remove('hidden');
                generateCards(filteredProducts, 'product-grid');
                generateCards(filteredAccessories, 'accessory-grid');
            } else if (currentFilter === 'oils') {
                productsSection.classList.remove('hidden');
                accessoriesSection.classList.add('hidden');
                generateCards(filteredProducts, 'product-grid');
                accessoryGrid.innerHTML = ''; // S'assurer que la grille des accessoires est vide
            } else if (currentFilter === 'accessories') {
                productsSection.classList.add('hidden');
                accessoriesSection.classList.remove('hidden');
                productGrid.innerHTML = ''; // S'assurer que la grille des produits est vide
                generateCards(filteredAccessories, 'accessory-grid');
            }
        }
        
        // Change le filtre actif et met à jour l'affichage
        function filterItems(type) {
            currentFilter = type;
            const buttons = document.querySelectorAll('.filter-btn');
            buttons.forEach(btn => {
                btn.classList.remove('bg-emerald-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-800');
            });

            const activeButton = document.getElementById(`filter-${type}`);
            if (activeButton) {
                activeButton.classList.remove('bg-gray-200', 'text-gray-800');
                activeButton.classList.add('bg-emerald-600', 'text-white');
            }
            applyFiltersAndSearch();
        }

        // Affiche la page de détails d'un produit et met à jour l'état
        function showProductPage(id) {
            const item = allItems.find(p => p.id === id);
            if (item) {
                appState.view = 'product-detail';
                appState.selectedProduct = item;
                updateView();
            } else {
                console.error('Produit non trouvé avec l\'ID :', id);
            }
        }
        
        // Revient à la page principale et met à jour l'état
        function showMainPage() {
            appState.view = 'main';
            appState.selectedProduct = null;
            updateView();
        }

        // Gère l'affichage des différentes vues
        function updateView() {
            const mainContent = document.getElementById('main-content');
            const productDetailPage = document.getElementById('product-detail-page');

            if (appState.view === 'main') {
                mainContent.classList.remove('hidden');
                productDetailPage.classList.add('hidden');
            } else {
                mainContent.classList.add('hidden');
                productDetailPage.classList.remove('hidden');
                renderProductDetail(appState.selectedProduct);
            }
        }

        // Rend les détails d'un produit sur la page de détail
        function renderProductDetail(item) {
            document.getElementById('product-detail-image').src = item.image;
            document.getElementById('product-detail-title').innerText = item.title;
            document.getElementById('product-detail-subtitle').innerText = item.subtitle;
            document.getElementById('product-detail-description').innerText = item.description;
            document.getElementById('product-detail-price').innerText = `${item.price.toFixed(2)} €`;
            
            // Masquer le guide à chaque changement de page
            document.getElementById('guide-result').innerHTML = '';
            document.getElementById('guide-result').classList.add('hidden');

            const isOil = item.type === 'oil';
            const getGuideBtn = document.querySelector('#product-detail-page button[onclick="getOilGuide()"]');
            getGuideBtn.classList.toggle('hidden', !isOil);
            
            // Utilise l'ID du produit pour la fonction d'ajout au panier optimisée
            document.getElementById('add-to-cart-detail-btn').onclick = () => addToCart(item);
        }

        // Ajoute un produit au panier
        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.id);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCart();
        }
        
        // Fermer un modal spécifique
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
        }

        // Logique du panier d'achat
        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            updateCart();
        }
        
        function changeQuantity(id, change) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(id);
                } else {
                    updateCart();
                }
            }
        }

        function emptyCart() {
            cart = [];
            updateCart();
        }

        function updateCart() {
            updateCartCount();
            renderCartItems();
            updateCartTotal();
        }

        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').innerText = count;
        }

        function renderCartItems() {
            const cartItemsContainer = document.getElementById('cart-items');
            cartItemsContainer.innerHTML = '';
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-center text-gray-500">Votre panier est vide.</p>';
                return;
            }
            cart.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('flex', 'justify-between', 'items-center', 'bg-gray-50', 'p-3', 'rounded-lg', 'shadow-sm');
                itemElement.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <img src="${item.image}" alt="${item.title}" class="w-12 h-12 object-cover rounded-lg">
                        <div>
                            <p class="font-semibold text-gray-800">${item.title}</p>
                            <p class="text-sm text-gray-600">${item.price.toFixed(2)} € / unité</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="changeQuantity(${item.id}, -1)" class="bg-gray-200 text-gray-700 w-8 h-8 rounded-full">-</button>
                        <span class="font-bold text-gray-800">${item.quantity}</span>
                        <button onclick="changeQuantity(${item.id}, 1)" class="bg-gray-200 text-gray-700 w-8 h-8 rounded-full">+</button>
                    </div>
                `;
                cartItemsContainer.appendChild(itemElement);
            });
        }

        function updateCartTotal() {
            const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            document.getElementById('cart-total').innerText = `${total.toFixed(2)} €`;
        }

        function openCartModal() {
            renderCartItems();
            updateCartTotal();
            const modal = document.getElementById('cart-modal');
            modal.style.display = 'flex';
        }

        // Logique du carrousel
        let currentSlide = 0;
        const totalSlides = carouselSlides.length;
        const track = document.getElementById('carousel-track');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const dotsContainer = document.getElementById('carousel-dots');

        function generateCarousel() {
            let slidesHtml = '';
            let dotsHtml = '';
            carouselSlides.forEach((slide, index) => {
                slidesHtml += `
                    <div class="w-full flex-shrink-0 relative h-full bg-cover bg-center" style="background-image: url('${slide.image}');">
                        <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 text-center text-white">
                            <div>
                                <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-shadow-custom leading-tight mb-4">
                                    ${slide.title}
                                </h1>
                                <p class="text-xl md:text-2xl font-semibold text-gray-200 mb-2">${slide.subtitle || ''}</p>
                                <p class="text-lg text-gray-300 mb-6">${slide.description || ''}</p>
                                <a href="${slide.buttonHref}" class="bg-white text-emerald-600 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-gray-200 transition duration-300 transform hover:scale-105">
                                    ${slide.buttonText}
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                dotsHtml += `<div class="w-3 h-3 rounded-full bg-white opacity-50 cursor-pointer transition-opacity duration-300" onclick="goToSlide(${index})"></div>`;
            });
            track.innerHTML = slidesHtml;
            dotsContainer.innerHTML = dotsHtml;
            updateDots();
        }

        function updateDots() {
            const dots = dotsContainer.querySelectorAll('div');
            dots.forEach((dot, index) => {
                dot.classList.toggle('opacity-100', index === currentSlide);
                dot.classList.toggle('opacity-50', index !== currentSlide);
            });
        }

        function showSlide(index) {
            if (index >= totalSlides) {
                currentSlide = 0;
            } else if (index < 0) {
                currentSlide = totalSlides - 1;
            } else {
                currentSlide = index;
            }
            track.style.transform = `translateX(-${currentSlide * 100}%)`;
            updateDots();
        }

        function nextSlide() {
            showSlide(currentSlide + 1);
        }

        function prevSlide() {
            showSlide(currentSlide - 1);
        }

        function goToSlide(index) {
            showSlide(index);
            // Reset the interval when a dot is clicked
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 5000);
        }

        nextBtn.addEventListener('click', () => {
            nextSlide();
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 5000);
        });

        prevBtn.addEventListener('click', () => {
            prevSlide();
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 5000);
        });
        
        // Gemini API logic
        const API_KEY = ""; // Provided by the environment
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + API_KEY;
        
        async function callGeminiApi(prompt, systemInstruction, maxRetries = 3, delay = 1000) {
            let attempt = 0;
            while (attempt < maxRetries) {
                try {
                    const payload = {
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] },
                    };
                    
                    showLoadingMessage(true);

                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    showLoadingMessage(false);
                    return text || 'Désolé, je n\'ai pas pu générer de réponse.';
                } catch (error) {
                    attempt++;
                    console.error(`Attempt ${attempt} failed:`, error);
                    if (attempt < maxRetries) {
                        await new Promise(res => setTimeout(res, delay * Math.pow(2, attempt)));
                    } else {
                        showLoadingMessage(false);
                        return 'Une erreur est survenue lors de la connexion au serveur. Veuillez réessayer plus tard.';
                    }
                }
            }
        }
        
        function showLoadingMessage(show) {
            const loadingElement = document.getElementById('loading-message');
            loadingElement.style.display = show ? 'block' : 'none';
        }

        async function getAromatherapyAdvice() {
            const userNeed = document.getElementById('aromatherapy-need').value || 'bien-être général';
            const selectedOilTitles = selectedOils.map(oil => oil.title).join(', ');
            const resultDiv = document.getElementById('aromatherapy-result');
            
            if (selectedOils.length === 0) {
                resultDiv.classList.remove('hidden');
                resultDiv.innerHTML = `<p class="text-red-500">Veuillez sélectionner au moins une huile essentielle pour créer une recette.</p>`;
                return;
            }
            
            const prompt = `Pour le besoin suivant: ${userNeed}. J'ai ces huiles disponibles: ${selectedOilTitles}. Proposez une recette de mélange, une méthode d'utilisation et une explication des bienfaits de chaque huile dans le mélange. La réponse doit être structurée en titres HTML (h3, h4) et paragraphes (p).`;
            const systemInstruction = `Vous êtes un expert en aromathérapie. Fournissez des conseils et des recettes de mélanges d'huiles essentielles. Répondez de manière amicale et professionnelle.`;
            
            const advice = await callGeminiApi(prompt, systemInstruction);
            
            resultDiv.innerHTML = `<h3>Conseils pour "${userNeed}"</h3>` + advice;
            resultDiv.classList.remove('hidden');
        }
        
        async function getOilGuide() {
            const item = appState.selectedProduct;
            const guideDiv = document.getElementById('guide-result');
            
            const prompt = `Créez un guide détaillé pour l'huile essentielle suivante : ${item.title}. Incluez les sections suivantes: Propriétés principales, Usages courants (diffusion, application cutanée, etc.), Précautions d'emploi. La réponse doit être structurée avec des titres HTML (h3) et des listes (ul/li).`;
            const systemInstruction = `Vous êtes un expert en aromathérapie. Fournissez un guide détaillé sur l'huile essentielle spécifiée. Répondez de manière professionnelle et éducative. La réponse doit être formatée en HTML.`;
            
            const guide = await callGeminiApi(prompt, systemInstruction);
            
            guideDiv.innerHTML = guide;
            guideDiv.classList.remove('hidden');
        }

        // Appeler la fonction au chargement de la page pour générer les cartes et le carrousel
        document.addEventListener('DOMContentLoaded', () => {
            applyFiltersAndSearch();
            updateCartCount();
            generateCarousel();
            renderSelectedOils();
            slideInterval = setInterval(nextSlide, 5000); // Auto-play every 5 seconds
            document.getElementById('search-input').addEventListener('input', applyFiltersAndSearch);
        });

        // Fermer le modal en cliquant à l'extérieur
        window.onclick = function(event) {
            const productModal = document.getElementById('product-modal');
            const cartModal = document.getElementById('cart-modal');
            if (event.target == productModal) {
                closeModal('product-modal');
            }
            if (event.target == cartModal) {
                closeModal('cart-modal');
            }
        }
    </script>
</body>
</html>
